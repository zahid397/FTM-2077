<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>FTM-2077 OMEGA</title>

<style>
/* ================= CYBERPUNK THEME ================= */
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

:root {
    --neon-green: #0f0;
    --dark-green: #001a00;
    --black: #050505;
    --glass: rgba(0, 20, 0, 0.85);
}

body {
    margin: 0;
    background-color: var(--black);
    color: var(--neon-green);
    font-family: 'Share Tech Mono', monospace;
    height: 100dvh; /* Mobile friendly height */
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

/* BACKGROUND MATRIX CANVAS */
#matrix {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    opacity: 0.25; /* Background fading */
}

/* ================= UI LAYOUT ================= */
#terminal-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    border-left: 1px solid rgba(0, 255, 0, 0.1);
    border-right: 1px solid rgba(0, 255, 0, 0.1);
    position: relative;
    z-index: 10;
}

/* OUTPUT AREA */
.output-area {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    scroll-behavior: smooth;
    font-size: 16px;
    text-shadow: 0 0 2px var(--neon-green);
}

/* Hide scrollbar but allow scroll */
.output-area::-webkit-scrollbar { width: 5px; }
.output-area::-webkit-scrollbar-thumb { background: var(--neon-green); }

/* MESSAGE STYLES */
.msg { margin-bottom: 12px; line-height: 1.4; }
.user-msg { color: #88ff88; border-left: 2px solid #88ff88; padding-left: 8px; opacity: 0.8; }
.ai-msg { color: var(--neon-green); }
.sys-msg { color: cyan; font-size: 14px; opacity: 0.7; }
.error-msg { color: #ff3333; }

/* ================= INPUT & BUTTON AREA ================= */
.control-panel {
    background: black;
    border-top: 2px solid var(--neon-green);
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    box-shadow: 0 -5px 20px rgba(0, 255, 0, 0.1);
}

/* INPUT BOX */
.input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    background: var(--dark-green);
    border: 1px solid var(--neon-green);
}

.prompt-char {
    padding-left: 10px;
    color: var(--neon-green);
    font-weight: bold;
    font-size: 18px;
}

input[type="text"] {
    width: 100%;
    background: transparent;
    border: none;
    color: var(--neon-green);
    font-family: 'Share Tech Mono', monospace;
    font-size: 18px;
    padding: 12px;
    outline: none;
}

/* TACTICAL BUTTON (Like 2nd Pic) */
.execute-btn {
    width: 100%;
    background: black;
    border: 2px solid var(--neon-green);
    color: var(--neon-green);
    font-family: 'Share Tech Mono', monospace;
    font-size: 18px;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 2px;
    padding: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 0 5px var(--neon-green);
    text-align: center;
    position: relative;
    overflow: hidden;
}

/* Button Hover/Active Effects */
.execute-btn:active {
    background: var(--neon-green);
    color: black;
    box-shadow: 0 0 25px var(--neon-green);
}

.execute-btn::after {
    content: " [SEND]";
    opacity: 0.5;
    font-size: 14px;
}

/* BLINK ANIMATION */
.blink { animation: blinker 1s linear infinite; }
@keyframes blinker { 50% { opacity: 0; } }

</style>
</head>
<body>

<canvas id="matrix"></canvas>

<div id="terminal-container">
    <div class="output-area" id="output">
        <div class="msg sys-msg">
            FTM-2077 OMEGA OS v3.1<br>
            SECURE CONNECTION: ESTABLISHED<br>
            NEURAL LINK: ACTIVE
        </div>
        <div class="msg ai-msg">
            Awaiting directives.
        </div>
    </div>

    <div class="control-panel">
        <div class="input-wrapper">
            <span class="prompt-char">></span>
            <input type="text" id="cmdInput" placeholder="Enter command..." autocomplete="off">
        </div>
        <button class="execute-btn" onclick="runMission()">EXECUTE</button>
    </div>
</div>

<script>
/* ================= 1. ADVANCED MATRIX RAIN (PRO) ================= */
const canvas = document.getElementById('matrix');
const ctx = canvas.getContext('2d');

function resizeMatrix() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeMatrix);
resizeMatrix();

// KATAKANA + LATIN CHARACTERS (Like the movie)
const katakana = 'アァカサタナハマヤャラワガザダバパイィキシチニヒミリヰギジヂビピウゥクスツヌフムユュルグズブヅプエェケセテネヘメレヱゲゼデベペオォコソトノホモヨョロヲゴゾドボポヴッン';
const latin = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
const alphabet = katakana + latin;

const fontSize = 16;
const columns = canvas.width / fontSize;
const drops = [];

// Initialize drops
for(let x = 0; x < columns; x++) {
    drops[x] = 1;
}

function draw() {
    // Black with opacity for trail effect
    ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = '#0F0'; // Neon Green
    ctx.font = fontSize + 'px monospace';

    for(let i = 0; i < drops.length; i++) {
        const text = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);

        // Random reset to create variation
        if(drops[i] * fontSize > canvas.height && Math.random() > 0.975)
            drops[i] = 0;
        
        drops[i]++;
    }
}
setInterval(draw, 30); // 30ms Speed

/* ================= 2. CORE LOGIC (BACKEND + VOICE) ================= */
const API_URL = "https://ftm-2077.onrender.com/api/execute";
const DEFAULT_PERSONA = "JARVIS";

const inputEl = document.getElementById("cmdInput");
const outputEl = document.getElementById("output");

let isTyping = false;

// --- Auto Scroll ---
function scrollToBottom() {
    outputEl.scrollTop = outputEl.scrollHeight;
}

// --- Typing Effect ---
function typeWriter(text, element) {
    if (isTyping) return;
    isTyping = true;
    
    let i = 0;
    const speed = 20; // Typing speed
    
    function type() {
        if (i < text.length) {
            const char = text.charAt(i);
            if (char === '\n') element.innerHTML += '<br>';
            else element.innerHTML += char;
            
            i++;
            scrollToBottom();
            setTimeout(type, speed);
        } else {
            isTyping = false;
        }
    }
    type();
}

// --- Voice Engine ---
function speak(text) {
    if (!window.speechSynthesis) return;
    window.speechSynthesis.cancel();

    const utterance = new SpeechSynthesisUtterance(text);
    const voices = window.speechSynthesis.getVoices();
    // Prefer Google UK Male or any Male voice
    const voice = voices.find(v => v.name.includes("UK") || v.name.includes("Male")) || voices[0];
    
    if (voice) utterance.voice = voice;
    utterance.pitch = 0.8;
    utterance.rate = 1.0;
    
    window.speechSynthesis.speak(utterance);
}

// --- Execute Command ---
async function runMission() {
    const cmd = inputEl.value.trim();
    if (!cmd || isTyping) return;

    // 1. Show User Command
    outputEl.innerHTML += `<div class="msg user-msg">> ${cmd}</div>`;
    inputEl.value = "";
    scrollToBottom();

    // 2. Show Loading
    const loadingId = "load-" + Date.now();
    outputEl.innerHTML += `<div class="msg sys-msg blink" id="${loadingId}">[PROCESSING...]</div>`;
    scrollToBottom();

    try {
        const response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ command: cmd, persona: DEFAULT_PERSONA })
        });

        const data = await response.json();
        
        // Remove Loading
        document.getElementById(loadingId).remove();

        // 3. Display AI Response
        if (data.text) {
            const aiDiv = document.createElement("div");
            aiDiv.className = "msg ai-msg";
            outputEl.appendChild(aiDiv);
            
            typeWriter(data.text, aiDiv);
            speak(data.text);
        } else {
            outputEl.innerHTML += `<div class="msg error-msg">ERROR: EMPTY RESPONSE</div>`;
        }

    } catch (e) {
        document.getElementById(loadingId).remove();
        console.error(e);
        outputEl.innerHTML += `<div class="msg error-msg">SERVER ERROR: Backend might be sleeping. Try again in 30s.</div>`;
    }
    scrollToBottom();
}

// --- Event Listeners ---
inputEl.addEventListener("keypress", (e) => {
    if (e.key === "Enter") runMission();
});

// Focus input on load
window.onload = () => inputEl.focus();

</script>
</body>
</html>
