<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>FTM-2077: OMEGA OS</title>

<style>
/* ================= 1. CORE VISUALS ================= */
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

:root {
    --primary: #0f0;         /* Neon Green */
    --dim-green: #003300;    /* Dark Green */
    --bg-color: #000;        /* Black */
}

* { box-sizing: border-box; }

body {
    margin: 0;
    background-color: var(--bg-color);
    color: var(--primary);
    font-family: 'Share Tech Mono', monospace;
    height: 100dvh;
    overflow: hidden;
    position: relative;
}

/* MATRIX CANVAS (FIXED VISIBILITY) */
canvas#matrix {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0; /* Background layer */
    opacity: 0.8; /* High visibility */
}

/* CRT SCANLINE OVERLAY (Retro Effect) */
.crt-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
    background-size: 100% 2px, 3px 100%;
    z-index: 1; /* Above matrix */
    pointer-events: none; /* Click through */
}

/* ================= 2. MAIN UI LAYER ================= */
#main-ui {
    position: relative;
    z-index: 10; /* Above everything */
    height: 100%;
    display: flex;
    flex-direction: column;
    background: rgba(0, 5, 0, 0.6); /* Slight glass effect */
}

/* TOP HUD */
.hud-bar {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    border-bottom: 2px solid var(--primary);
    background: rgba(0, 20, 0, 0.8);
    backdrop-filter: blur(2px);
}
.hud-item { text-align: center; }
.hud-label { font-size: 10px; color: cyan; display: block; }
.hud-val { font-size: 14px; font-weight: bold; }

/* CHAT OUTPUT area */
#console-log {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    font-size: 16px;
    text-shadow: 0 0 4px var(--primary);
}
/* Scrollbar */
#console-log::-webkit-scrollbar { width: 4px; }
#console-log::-webkit-scrollbar-thumb { background: var(--primary); }

/* MESSAGES */
.msg { margin-bottom: 12px; line-height: 1.4; word-wrap: break-word; }
.sys { color: #008f11; font-size: 12px; margin-bottom: 5px; }
.user { color: #ccffcc; border-left: 2px solid cyan; padding-left: 8px; }
.ai { color: var(--primary); }
.cursor { display: inline-block; width: 8px; height: 16px; background: var(--primary); animation: blink 1s infinite; }
@keyframes blink { 50% { opacity: 0; } }

/* BOTTOM CONTROLS */
.control-deck {
    background: black;
    border-top: 2px solid var(--primary);
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.input-row { display: flex; gap: 8px; height: 45px; }
.input-wrap {
    flex: 1; display: flex; align-items: center;
    background: var(--dim-green); border: 1px solid var(--primary);
    padding: 0 10px;
}
input {
    width: 100%; background: transparent; border: none;
    color: var(--primary); font-family: inherit; font-size: 16px; outline: none;
}
.exec-btn {
    width: 100%; height: 50px;
    background: linear-gradient(180deg, #002200, #000);
    border: 2px solid var(--primary); color: var(--primary);
    font-family: inherit; font-size: 18px; font-weight: bold;
    text-transform: uppercase; letter-spacing: 2px;
    cursor: pointer; transition: 0.2s;
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.2);
}
.exec-btn:active { background: var(--primary); color: black; }

</style>
</head>
<body>

<canvas id="matrix"></canvas>
<div class="crt-overlay"></div>

<div id="main-ui">
    
    <div class="hud-bar">
        <div class="hud-item"><span class="hud-label">CPU</span><span class="hud-val" id="cpu">34%</span></div>
        <div class="hud-item"><span class="hud-label">MEM</span><span class="hud-val" id="mem">12TB</span></div>
        <div class="hud-item"><span class="hud-label">NET</span><span class="hud-val">SECURE</span></div>
        <div class="hud-item"><span class="hud-label">OS</span><span class="hud-val" style="color:cyan">v3.1</span></div>
    </div>

    <div id="console-log">
        <div class="msg sys">
            INITIALIZING NEURAL LINK...<br>
            CONNECTION ESTABLISHED.<br>
            SYSTEM ONLINE.
        </div>
        <div class="msg ai">
            Awaiting directives.
        </div>
    </div>

    <div class="control-deck">
        <div class="input-row">
            <div class="input-wrap">
                <span style="margin-right:8px;">></span>
                <input type="text" id="cmd" placeholder="Enter command..." autocomplete="off">
            </div>
        </div>
        <button class="exec-btn" onclick="run()">EXECUTE</button>
    </div>

</div>

<script>
/* ================= 1. MATRIX RAIN ENGINE (FIXED) ================= */
const cvs = document.getElementById('matrix');
const ctx = cvs.getContext('2d');

function resize() {
    cvs.width = window.innerWidth;
    cvs.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// PRO CHARACTERS (Katakana + Latin)
const katakana = 'アァカサタナハマヤャラワガザダバパイィキシチニヒミリヰギジヂビピウゥクスツヌフムユュルグズブヅプエェケセテネヘメレヱゲゼデベペオォコソトノホモヨョロヲゴゾドボポヴッン';
const latin = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
const nums = '01';
const alphabet = katakana + latin + nums;

const fontSize = 14;
const columns = cvs.width / fontSize;
const drops = Array(Math.ceil(columns)).fill(1);

function draw() {
    // Semi-transparent black to create trail effect
    ctx.fillStyle = 'rgba(0, 0, 0, 0.05)'; 
    ctx.fillRect(0, 0, cvs.width, cvs.height);

    ctx.fillStyle = '#0F0'; // Bright Neon Green
    ctx.font = fontSize + 'px monospace';

    for(let i = 0; i < drops.length; i++) {
        const text = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);

        // Randomize reset to make it look like rain
        if(drops[i] * fontSize > cvs.height && Math.random() > 0.975)
            drops[i] = 0;

        drops[i]++;
    }
}

// Faster speed for smoother look
setInterval(draw, 35);


/* ================= 2. CORE LOGIC ================= */
const API = "https://ftm-2077.onrender.com/api/execute";
const log = document.getElementById('console-log');
const inp = document.getElementById('cmd');
let isProcessing = false;

function scrollToBottom() { log.scrollTop = log.scrollHeight; }

function typeWriter(text, el) {
    let i = 0;
    function t() {
        if (i < text.length) {
            el.innerHTML += (text[i] === '\n') ? '<br>' : text[i];
            i++;
            scrollToBottom();
            setTimeout(t, 20);
        } else {
            isProcessing = false;
        }
    }
    t();
}

function speak(text) {
    if(!window.speechSynthesis) return;
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    const v = window.speechSynthesis.getVoices().find(v=>v.name.includes('UK')||v.name.includes('Male'));
    if(v) u.voice = v;
    u.rate = 1.1; u.pitch = 0.9;
    window.speechSynthesis.speak(u);
}

async function run() {
    const cmd = inp.value.trim();
    if(!cmd || isProcessing) return;
    isProcessing = true;

    // UI Update
    log.innerHTML += `<div class="msg user">> ${cmd}</div>`;
    inp.value = ''; scrollToBottom();

    // Loading
    const loadId = 'load-' + Date.now();
    log.innerHTML += `<div class="msg sys" id="${loadId}">[PROCESSING NEURAL REQUEST...] <span class="cursor"></span></div>`;
    scrollToBottom();

    try {
        const res = await fetch(API, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({command: cmd, persona: 'JARVIS'})
        });
        const data = await res.json();
        
        document.getElementById(loadId).remove();

        const aiMsg = document.createElement('div');
        aiMsg.className = 'msg ai';
        log.appendChild(aiMsg);
        
        typeWriter(data.text, aiMsg);
        speak(data.text);

    } catch(e) {
        document.getElementById(loadId).remove();
        log.innerHTML += `<div class="msg sys" style="color:red">SERVER OFFLINE (Backend sleeping?)</div>`;
        isProcessing = false;
    }
}

// HUD Animation
setInterval(() => {
    document.getElementById('cpu').innerText = Math.floor(Math.random()*40+20) + '%';
    document.getElementById('mem').innerText = (Math.random()*2+8).toFixed(1) + 'TB';
}, 1000);

// Enter Key
inp.addEventListener('keypress', e => { if(e.key === 'Enter') run(); });

</script>
</body>
</html>
